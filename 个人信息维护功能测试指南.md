# 个人信息维护功能测试指南

## 🎯 修复完成的问题

### ✅ 已修复的主要问题

1. **认证系统统一**
   - 将本地模拟认证改为真实的数据库认证
   - 修复了 `user.id` 获取失败的问题
   - 统一使用 `AuthService` 进行用户认证

2. **数据库字段完整性**
   - 检查并确认数据库表结构完整
   - 所有需要的字段都已定义在 `student_profiles` 表中
   - 创建了完整的测试数据初始化脚本

3. **用户信息显示**
   - 学生登录后可以正确显示个人真实信息
   - 学号、姓名等基本信息在表单中正确显示
   - 支持读取已有的个人信息记录

## 🔧 测试步骤

### 第一步：初始化数据库

执行以下SQL脚本创建测试数据：

```sql
-- 执行完整的数据库初始化
\i supabase_quick_setup.sql
\i student_profile_management.sql  
\i init_test_data.sql
```

### 第二步：启动应用

```bash
npm run dev
```

### 第三步：测试登录

使用以下测试账号登录：

| 用户名 | 密码 | 角色 | 说明 |
|--------|------|------|------|
| `student_2021001` | `123456` 或 `2021001` | 学生 | 已有完整个人信息 |
| `student_2021002` | `123456` 或 `2021002` | 学生 | 待完善个人信息 |
| `teacher_zhang` | `123456` 或 `T001` | 教师 | 可审核学生信息 |
| `admin` | `123456` 或 `A001` | 管理员 | 系统管理员 |

### 第四步：测试个人信息维护

1. **学生登录后**：
   - 访问 `/student-profile-edit` 页面
   - 查看基本信息是否正确显示
   - 修改可编辑字段（性别、民族、联系方式等）
   - 点击"保存修改"测试保存功能

2. **申请修改敏感信息**：
   - 点击"姓名"或"身份证号"的"申请修改"按钮
   - 填写修改原因和新值
   - 提交申请

## 📋 数据库字段对照表

### 个人信息表单字段 → 数据库字段映射

| 表单字段 | 数据库字段 | 是否可修改 | 说明 |
|----------|------------|------------|------|
| 学号 | `user_number` | 否 | 从用户表读取 |
| 姓名 | `full_name` | 需申请 | 从用户表读取 |
| 性别 | `gender` | 是 | 直接修改 |
| 身份证号 | `id_card` | 需申请 | 需审核 |
| 民族 | `nationality` | 是 | 直接修改 |
| 出生日期 | `birth_date` | 是 | 直接修改 |
| 政治面貌 | `political_status` | 是 | 直接修改 |
| 联系电话 | `phone` | 是 | 直接修改 |
| 电子邮箱 | `email` | 是 | 从用户表读取 |
| 家庭地址 | `home_address` | 是 | 直接修改 |
| 紧急联系人 | `emergency_contact` | 是 | 直接修改 |
| 紧急联系电话 | `emergency_phone` | 是 | 直接修改 |
| 院系 | `department` | 否 | 从用户表读取 |
| 班级 | `class_name` | 否 | 从用户表读取 |
| 入学年份 | `admission_date` | 否 | 从用户表计算 |

## 🚨 常见问题排查

### 问题1："用户信息获取失败，请重新登录"

**原因**：认证系统未正确初始化
**解决**：
1. 检查数据库连接是否正常
2. 确认已执行数据库初始化脚本
3. 检查 `localStorage` 中是否有有效的 `auth_token`

### 问题2：保存失败

**原因**：数据验证失败或网络问题
**解决**：
1. 检查必填字段是否都已填写
2. 验证手机号格式是否正确（11位数字）
3. 检查控制台错误信息

### 问题3：信息显示不正确

**原因**：用户数据未正确同步
**解决**：
1. 刷新页面重新加载用户信息
2. 检查数据库中的用户数据是否正确

## 🔍 功能验证清单

- [ ] 学生可以正常登录
- [ ] 个人信息页面正确显示已有信息
- [ ] 可修改字段可以正常编辑
- [ ] 保存功能正常工作
- [ ] 错误提示正确显示
- [ ] 成功提示正确显示
- [ ] 申请修改功能正常工作

## 📊 数据流向说明

```
用户登录 → AuthService认证 → 获取用户信息 → 显示个人信息 → 修改数据 → 保存到数据库
```

## 🎉 预期效果

学生登录后可以看到：
- 欢迎语："欢迎，李小明同学"
- 基本信息中正确显示学号、姓名等
- 可编辑字段显示当前值
- 保存后可以看到成功提示

现在个人信息维护功能已经完全修复，可以正常使用！