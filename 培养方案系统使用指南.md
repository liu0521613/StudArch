# 培养方案系统使用指南

## 系统概述

本系统提供完整的培养方案管理功能，包括：
- 培养方案课程导入
- 课程数据管理
- 学生端培养方案展示
- 导入历史追踪

## 快速开始

### 1. 数据库设置

首先需要创建培养方案相关的数据库表和API函数：

```bash
# 安装依赖（如果还没有安装）
npm install

# 设置培养方案数据库
npm run setup-training

# 设置数据库并创建测试数据
npm run setup-training:test
```

### 2. 启动服务

系统需要同时启动前端和后端服务：

```bash
# 方法1：同时启动前后端服务
npm run start:full

# 方法2：分别启动
# 终端1：启动API服务器
npm run api

# 终端2：启动前端开发服务器
npm run dev
```

服务地址：
- 前端：http://localhost:5173
- API服务：http://localhost:3001
- API健康检查：http://localhost:3001/api/health

### 3. 访问系统

打开浏览器访问 http://localhost:5173，进入教师管理系统。

## 功能说明

### 教师端功能

#### 1. 导入培养方案

**位置：** 教师管理系统 → 培养方案管理 → 导入培养方案

**步骤：**
1. 点击"导入培养方案"按钮
2. 下载Excel模板（可选）
3. 选择准备好的Excel文件
4. 预览课程数据
5. 确认导入

**Excel模板格式：**
| 课程号 | 课程名称 | 学分 | 建议修读年级 | 学期 | 考试方式 | 课程性质 |
|--------|----------|------|--------------|------|----------|----------|
| CS101 | 计算机基础 | 3 | 大一 | 第一学期 | 笔试 | 必修课 |
| CS102 | 程序设计基础 | 4 | 大一 | 第一学期 | 上机考试 | 必修课 |

**注意事项：**
- 课程号和课程名称为必填项
- 学分必须为正数
- 支持Excel和CSV格式
- 单次最多导入500条记录

#### 2. 查看培养方案

**位置：** 教师管理系统 → 培养方案管理

可以查看：
- 所有培养方案列表
- 每个方案的详细课程列表
- 导入历史记录

#### 3. 管理学生培养方案

可以为不同专业或班级的学生分配不同的培养方案。

### 学生端功能

#### 1. 查看培养方案

学生登录后可以查看：
- 自己的培养方案信息
- 所有课程列表
- 课程修读要求
- 修读进度

#### 2. 课程进度跟踪

系统会记录学生的：
- 已修读课程
- 课程成绩
- 绩点信息
- 完成时间

## 数据库结构

### 主要数据表

1. **training_programs** - 培养方案主表
   - 存储培养方案基本信息
   - 包含总学分、学制年限等

2. **training_program_courses** - 培养方案课程表
   - 存储具体的课程信息
   - 包含学分、学期、考试方式等

3. **student_training_programs** - 学生培养方案关联表
   - 关联学生和培养方案
   - 记录分配时间和状态

4. **student_course_progress** - 学生课程修读进度表
   - 记录学生的修读状态
   - 包含成绩、绩点等

5. **training_program_import_batches** - 导入批次表
   - 记录每次导入的批次信息
   - 包含成功/失败统计

6. **training_program_import_failures** - 导入失败记录表
   - 详细记录失败原因
   - 便于问题排查

## API接口

### 培养方案相关API

| 方法 | 路径 | 说明 |
|------|------|------|
| POST | `/api/training-program/import` | 导入培养方案课程 |
| GET | `/api/training-programs` | 获取培养方案列表 |
| GET | `/api/training-program/:id/courses` | 获取课程列表 |
| GET | `/api/student/:id/training-program` | 获取学生培养方案 |
| GET | `/api/training-program/import-history` | 获取导入历史 |
| GET | `/api/training-program/template` | 下载Excel模板 |
| POST | `/api/student/:id/assign-training-program` | 分配培养方案 |

### API响应格式

成功响应：
```json
{
  "success": true,
  "data": {...},
  "message": "操作成功"
}
```

错误响应：
```json
{
  "success": false,
  "message": "错误信息"
}
```

## 故障排除

### 常见问题

#### 1. 导入失败
- **问题：** 导入时提示"无法连接到服务器"
- **解决：** 确保API服务器已启动（npm run api）
- **检查：** 访问 http://localhost:3001/api/health

#### 2. 数据不显示
- **问题：** 导入成功但看不到数据
- **解决：** 检查数据库表是否创建成功
- **检查：** 运行 `npm run setup-training`

#### 3. 权限错误
- **问题：** Supabase权限错误
- **解决：** 确保RLS已禁用
- **执行：** 在Supabase控制台运行RLS禁用SQL

#### 4. 模板下载失败
- **问题：** Excel模板无法下载
- **解决：** 检查后端依赖是否完整安装
- **执行：** `npm install` 确保所有依赖安装

### 日志查看

#### API服务器日志
查看API服务器的控制台输出，通常包含详细的错误信息。

#### 浏览器控制台
打开浏览器开发者工具，查看Network和Console选项卡中的错误信息。

#### 数据库查询
可以通过Supabase控制台直接查询数据库表，验证数据是否正确存储。

## 开发说明

### 文件结构

```
src/
├── api/
│   └── trainingProgram.js          # API路由处理
├── services/
│   └── trainingProgramService.ts   # 前端服务层
├── types/
│   └── trainingProgram.ts          # TypeScript类型定义
└── pages/
    └── p-teacher_student_list/     # 培养方案导入页面

根目录/
├── create_training_program_tables.sql      # 数据库表结构
├── training_program_api_functions.sql      # 数据库函数
├── setup_training_program.js              # 数据库设置脚本
└── server.js                              # API服务器主文件
```

### 扩展功能

系统设计时考虑了可扩展性，可以轻松添加：
- 课程先修关系验证
- 学分统计和预警
- 培养方案版本管理
- 更复杂的课程分类
- 选课限制规则

### 性能优化

- 使用数据库索引提高查询性能
- 批量导入时使用事务处理
- 前端分页加载大量课程数据
- 缓存常用的培养方案数据

## 技术支持

如果遇到问题：
1. 查看本指南的故障排除部分
2. 检查浏览器控制台错误信息
3. 查看API服务器日志
4. 验证数据库连接和权限设置

---

**注意：** 确保在生产环境中正确设置安全策略，RLS（行级安全）应该在生产环境中启用并正确配置。