# 教师批量导入学生功能测试指南

## 功能概述

已经完善了教师管理平台的批量导入功能，现在教师可以：

1. 点击"批量导入"按钮查看所有已授权的学生
2. 通过搜索功能筛选要导入的学生
3. 勾选想要导入的学生
4. 一键将选中的学生添加到自己的管理列表中

## 主要改进

### 1. 数据库结构
- 创建了 `teacher_students` 表来存储教师和学生的关联关系
- 添加了适当的索引和行级安全策略
- 创建了专门的数据库函数来处理相关业务逻辑

### 2. API接口
- `get_authorized_students()`: 获取所有已授权学生供教师选择
- `get_teacher_students()`: 获取教师当前管理的学生列表
- `batch_add_students_to_teacher()`: 批量添加学生到教师管理列表
- `remove_student_from_teacher()`: 移除教师的学生

### 3. 前端界面
- 重新设计了批量导入模态框
- 添加了学生搜索和选择功能
- 实现了分页和批量操作
- 优化了用户体验和交互

## 测试步骤

### 1. 准备数据库
```sql
-- 执行以下SQL脚本来创建必要的表结构
-- teacher_student_management.sql
```

### 2. 启动应用
```bash
npm run dev
```

### 3. 测试流程

#### 3.1 查看批量导入功能
1. 访问教师管理平台
2. 进入"我的学生"页面
3. 点击"批量导入"按钮
4. 验证是否能看到已授权的学生列表

#### 3.2 搜索功能测试
1. 在搜索框中输入学号、姓名或邮箱
2. 验证搜索结果是否正确
3. 测试清空搜索功能

#### 3.3 选择和导入测试
1. 选择几个学生（可以单个选择或全选）
2. 点击"确认导入"按钮
3. 验证是否成功导入
4. 关闭模态框，查看主列表是否已显示新导入的学生

#### 3.4 分页功能测试
1. 如果学生数量较多，验证分页是否正常工作
2. 测试上一页/下一页功能
3. 验证页面跳转功能

### 4. 验证功能

#### 4.1 数据持久化
- 刷新页面后，验证导入的学生是否仍然存在
- 检查数据库中的 `teacher_students` 表是否有正确的记录

#### 4.2 权限控制
- 验证教师只能看到自己的学生
- 验证教师只能管理自己导入的学生
- 测试批量删除功能

#### 4.3 错误处理
- 测试网络中断时的错误提示
- 验证重复导入的处理
- 测试无效数据的处理

## 技术实现要点

### 1. 数据库设计
```sql
-- 核心表结构
CREATE TABLE teacher_students (
    id UUID PRIMARY KEY DEFAULT gen_random_uuid(),
    teacher_id UUID NOT NULL REFERENCES users(id),
    student_id UUID NOT NULL REFERENCES users(id),
    created_at TIMESTAMP WITH TIME ZONE DEFAULT NOW(),
    created_by UUID REFERENCES users(id),
    UNIQUE(teacher_id, student_id)
);
```

### 2. API设计
- 使用 Supabase RPC 函数来处理复杂查询
- 实现了事务安全的批量操作
- 添加了适当的权限控制

### 3. 前端实现
- 使用 React Hooks 管理状态
- 实现了响应式设计
- 添加了加载状态和错误处理

## 注意事项

1. **教师ID获取**: 当前使用硬编码的 `current-teacher-id`，实际应用中应该从认证状态中获取
2. **错误处理**: 需要根据实际业务需求完善错误处理逻辑
3. **性能优化**: 对于大量数据的场景，可能需要进一步优化查询性能
4. **权限验证**: 确保所有操作都有适当的权限验证

## 扩展功能建议

1. **导入历史**: 记录教师的导入历史
2. **自动分配**: 基于规则自动分配学生给教师
3. **批量操作**: 支持批量修改学生信息
4. **导入模板**: 支持Excel模板导入
5. **通知系统**: 导入完成后通知相关学生

## 故障排除

### 常见问题

1. **无法看到学生列表**
   - 检查数据库连接
   - 验证学生数据是否存在
   - 检查权限设置

2. **导入失败**
   - 检查教师权限
   - 验证学生ID是否有效
   - 检查数据库约束

3. **页面不刷新**
   - 检查状态更新逻辑
   - 验证API调用是否成功
   - 检查组件重新渲染

### 调试步骤

1. 打开浏览器开发者工具
2. 查看控制台错误信息
3. 检查网络请求状态
4. 验证数据库查询结果